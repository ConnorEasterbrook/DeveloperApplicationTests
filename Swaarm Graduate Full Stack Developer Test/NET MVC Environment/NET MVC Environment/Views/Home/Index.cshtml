@{
    ViewData["Title"] = "Home Page";
}

<div id="root">
    <div class="text-center" id="container">
        <div>
            <h1 class="display-4">Swaarm Graduate Full Stack Developer Test</h1>
            <p>Started Monday 16/04/2023 16:00:00.</p>
        </div>

        <input type="text" id="name-input" placeholder="Name" />
        <input type="email" id="email-input" placeholder="Email" />
        <button id="submit-button" onclick="submitInfo()">Submit</button>

        <div id="data-section">
            <div>
                <table id="db-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody id="data-container"></tbody>
                </table>
            </div>

            <button id="clear-button" onclick="clearTable()">Clear Table</button>
        </div>
    </div>

    <script>
        function fetchAllData()
        {
            fetch('@Url.Action("GetAllData", "Home")')
                .then(response => response.json())
                .then(data =>
                {
                    if (data.length === 0)
                    {
                        hideDataSection();
                        return;
                    }

                    showDataSection();

                    let html = '';
                    for (const obj of data)
                    {
                        html += '<tr>';
                        for (const [key, value] of Object.entries(obj))
                        {
                            if (key === 'id')
                            {
                                continue;
                            }
                            html += `<td>${value}</td>`;
                        }
                        html += '</tr>';
                    }
                    document.querySelector('#data-container').innerHTML = html;
                })
                .catch(error =>
                {
                    console.error(error);
                    alert("An error occurred while fetching the data.");
                });
        }

        function hideDataSection()
        {
            document.querySelector('#data-section').style.display = 'none';
            return;
        }

        function showDataSection()
        {
            document.querySelector('#data-section').style.display = 'block';
            return;
        }

        fetchAllData();

        function submitInfo() 
        {
            var name = $('#name-input').val();
            var email = $('#email-input').val();

            if (!validateEmail(email)) 
            {
                alert("Please enter a valid email address.");
                return;
            }

            $.ajax({
                url: "/Home/AddContact",
                type: "POST",
                data: { name: name, email: email },
                success: function (result) 
                {
                    alert("Success");
                    fetchAllData();
                },
                error: function (xhr, textStatus, errorThrown) 
                {
                    alert("An error occurred while calling the C# function.");
                }
            });
        }

        function validateEmail(email) 
        {
            var re = /^[a-zA-Z0-9._%+-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i;
            return re.test(email);
        }

        function clearTable()
        {
            $.ajax({
                url: "/Home/ClearTable",
                type: "POST",
                success: function (result) 
                {
                    alert("Success");
                    fetchAllData();
                },
                error: function (xhr, textStatus, errorThrown) 
                {
                    alert("An error occurred while calling the C# function.");
                }
            });
        }
    </script>
</div>
